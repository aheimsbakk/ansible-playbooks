---
- name: container jellyfin
  hosts: podman
  become: true

  vars:
    container_customization: "{{ container_jellyfin | default( {} ) }}"
    container_defaults:
      image: docker.io/jellyfin/jellyfin:latest
      name: jellyfin
      network: dmz
      expose:
        - 8096
      user: nobody
      generate_systemd: "{{ generate_systemd }}"
      volume:
        - /srv/jellyfin/config:/config:z,U
        - /srv/jellyfin/cache:/cache:z,U
        - /srv/jellyfin/media:/media:z,U
      label:
        io.containers.autoupdate: registry
        traefik.enable: "true"
        traefik.http.services.jellyfin.loadbalancer.server.port: "8096"
        traefik.http.routers.jellyfin.entrypoints: "websecure"
        traefik.http.routers.jellyfin.middlewares: "private-ip-ranges-no-podman"


  tasks:
    - name: download and run container
      ansible.builtin.import_tasks:
        file: podman-run.yml
